service: auditlog

provider:
  name: aws
  runtime: java8
  stage: ${opt:stage, 'dev'}
  region: eu-west-1
  role: arn:aws:iam::500150530292:role/oph/omaopintopolkuloki/dev/lambda/parser/oma-opintopolku-loki-dev-parser-role
  environment:
    env: ${self:provider.stage}


package:
  artifact: target/omaopintopolkuloki-1.0-SNAPSHOT.jar

functions:
  parser:
    description: Function that reads Koski audit log entries from SQS, processes them and stores to DynamoDB
    memorySize: 512
    timeout: 60
    handler: fi.oph.omaopintopolkuloki.LambdaLogParserHandler
    events:
        - schedule:
            name: scheduled-parser-execution-event
            description: 'Trigger log parser automatically every 5 minutes'
            rate: rate(5 minutes)
            enabled:  true
    vpc:
      securityGroupIds:
        - sg-0728f94ef46d7a53b
      subnetIds:
        - subnet-045f164770dfc03c1
        - subnet-0e51f3ad382ac5551
        - subnet-0fdbe9dc651818e2c
